const BLOCK_SIZE=512,FILE_TYPE={GZIP:"GZIP",GZIP2:"GZIP2",TAR:"TAR",PLAIN:"PLAIN"};async function parseTar(e){let r=e.buffer||e;const t=checkFileType(r);if(t!=FILE_TYPE.GZIP&&t!=FILE_TYPE.TAR)throw new Error("The file format should be tar.gz or tar");if(t==FILE_TYPE.GZIP){const t=new ReadableStream({start(r){r.enqueue(new Uint8Array(e)),r.close()}}).pipeThrough(new DecompressionStream("gzip"));r=await new Response(t).arrayBuffer()}const n=[];let a=0;for(;a<r.byteLength-512;){let e=readString(r,a,100);if(0===e.length)break;const t=readString(r,a+345,155);t&&(e=`${t}${e}`);const o=readString(r,a+100,8),i=Number.parseInt(readString(r,a+108,8)),u=Number.parseInt(readString(r,a+116,8)),d=readNumber(r,a+124,12),s=readNumber(r,a+136,12),c=readNumber(r,a+156,1),f=0===c?"file":5===c?"directory":c,I=readString(r,a+265,32),T=readString(r,a+297,32),P=new Uint8Array(r,a+512,d);n.push({name:e,type:f,size:d,data:P,get text(){return(new TextDecoder).decode(this.data)},attrs:{mode:o,uid:i,gid:u,mtime:s,user:I,group:T}}),a+=512+512*Math.trunc(d/512),d%512&&(a+=512)}return n}function checkFileType(e){let r=readBytes(e,0,2);return"1f8b"===bufferToHex(r)?FILE_TYPE.GZIP:(r=readBytes(e,0,5),"425a683931"===bufferToHex(r)?FILE_TYPE.GZIP2:(r=readBytes(e,257,5),"7573746172"===bufferToHex(r)?FILE_TYPE.TAR:FILE_TYPE.PLAIN))}function readString(e,r,t){const n=new Uint8Array(e,r,t),a=n.indexOf(0);return(new TextDecoder).decode(n.slice(0,a))}function readNumber(e,r,t){const n=new Uint8Array(e,r,t);let a="";for(let e=0;e<t;e++)a+=String.fromCodePoint(n[e]);return Number.parseInt(a,8)}function readBytes(e,r,t){return e.slice(r,r+t)}function bufferToHex(e){const r=new Uint8Array(e);let t="";for(let e=0;e<r.length;e++)t+=r[e].toString(16).padStart(2,"0");return t}